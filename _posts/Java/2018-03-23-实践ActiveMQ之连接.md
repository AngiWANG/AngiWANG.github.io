---
layout: post
title: "实践ActiveMQ之连接"
date: 2018-03-21 11:08:00 +0800
categories: Java
tags: java JMS ActiveMQ
---



## 连接工厂

```xml
<bean id="amqConnectionFactory" class="org.apache.activemq.ActiveMQConnectionFactory"
		  p:brokerURL="failover:(tcp://localhost:61616)" p:userName="system" p:password="manager"/>
```

## 连接

```
ActiveMQ Transport tcp://localhost/127.0.0.1:61616@58000
ActiveMQ InactivityMonitor ReadCheckTimer
ActiveMQ InactivityMonitor WriteCheckTimer

ActiveMQ InactivityMonitor Worker
```

每个连接（`ActiveMQConnection`）维持一个`TaskRunnerFactory`（`Executor`），参数如下：

```properties
name:ActiveMQ Session Task
core:0
max:1000
keepalived:30 second
workQueue:SynchronousQueue
maxIterationsPerRun:1000
```

`TaskRunner`（`PooledTaskRunner`）是任务（`Task`（`ActiveMQSessionExecutor`））的运行者，一个`ActiveMQSessionExecutor`持有一个`TaskRunner`

Transport读取消息后先放入`ActiveMQSessionExecutor`的`MessageDispatchChannel`结束。

![Transport栈](/images/ActiveMQ-transport-frames.png)