---
layout: post
title: "实践Netty之消息长度编解码"
date: 2018-05-23 11:08:00 +0800
categories: Java
tags: java Netty
---

## LengthFieldBasedFrameDecoder

[消息头]长度域[消息头]消息体

长度域（lengthField）默认代表的是紧跟其后的消息体的长度

private final int maxFrameLength;

最大长度
 private final int lengthFieldOffset;

长度域开始位置
 private final int lengthFieldLength;

长度域长度，unsigned 8/16/24/32/64 bit integer
 private final int lengthFieldEndOffset;

长度域结束位置=lengthFieldOffset + lengthFieldLength

长度值修正
 private final int initialBytesToStrip;

剥去前面字节数



LengthFieldBasedFrameDecoder(1024, 0, 2, 0, 0)

则读取到三条业务消息：16QUERY TIME

LengthFieldBasedFrameDecoder(1024, 0, 2, 0, 2)

则读取到三条业务消息：QUERY TIME

## LengthFieldPrepender



## ASCII编码长度解码

可以覆盖解析长度的方法，长度域长度类型如果为ascii，则如下：

```java
protected long getUnadjustedFrameLength(ByteBuf buf, int offset, int length, ByteOrder order){
	byte[] len = new byte[length];
	buf.getBytes(offset, len);
	return Long.parseLong(new String(len));
}
```

发送数据：

```java
"16QUERY TIME ORDER16QUERY TIME ORDER16QUERY TIME ORDER".getBytes()
```

 备注：长度域ascii编码，一个ascii字符一个字节

## ASCII编码长度编码